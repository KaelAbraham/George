{% extends "base.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>George Chat</title>
</head>
<body class="bg-gray-100 h-screen m-0 p-0">

    <div id="chat-root"
         data-project-id="{{ project_id }}"
         data-session-id="{{ session_id }}">
    </div>

    <script>
        // Pass the server-rendered chat history safely into the page
        window.__INITIAL_HISTORY__ = {{ chat_history | tojson }};
    </script>

    <!-- Load the Vite-built bundle -->
    <script type="module" src="{{ url_for('static', filename='dist/assets/index.js') }}"></script>

    <script>
        // Mount ChatApp once Vite bundle is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const root = document.getElementById('chat-root');
            const ChatApp = window.GeorgeClient.ChatApp;

            if (ChatApp && root) {
                const projectId = root.dataset.projectId;
                const sessionId = root.dataset.sessionId;
                const initialHistory = window.__INITIAL_HISTORY__ || [];

                const container = document.createElement('div');
                root.appendChild(container);

                const reactRoot = ReactDOM.createRoot(container);
                reactRoot.render(
                    React.createElement(ChatApp, {
                        projectId: projectId,
                        sessionId: sessionId,
                        initialHistory: initialHistory
                    })
                );
            }
        });
    </script>

</body>
</html>
{% endblock %}